<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8"/>
  <title>Tracker Download</title>

  <link rel="stylesheet" href="/player/css/player.css">

  <link rel="stylesheet" href="/author/css/author.css">

  <script src="/lib/axios-0.21.0/axios.min.js"></script>

  <script src="/lib/jquery-3-4-1/jquery-3.4.1.slim.min.js"></script>
  <script src="/lib/popper-1-15-0/popper.min.js"></script>
  <script src="/lib/bootstrap-4.4.1/js/bootstrap.min.js"></script>

  <script src="/config/config.js"></script>
  <script src="/dccs/infra/bus.js"></script>

  <script src="/dccs/base/primitive-dcc.js"></script>
  <script src="/dccs/base/scope-dcc.js"></script>
  <script src="/dccs/base/dcc.js"></script>
  <script src="/dccs/base/dcc-base.js "></script>
  <script src="/dccs/base/dcc-visual.js "></script>

  <script src="/infra/basic.js"></script>
  <script>
  Basic.service.rootPath = '../../'
  </script>

  <script src="/infra/dcc-common-server-proxy.js"></script>
  <script src="/infra/dcc-common-server-address.js"></script>
  <script src="/infra/simple-page-tasks.js"></script>
  <script src="/infra/token-validator.js"></script>

  <script src="/dccs/base/dcc-block.js"></script>
  <script src="/dccs/base/dcc-light.js "></script>

  <script src="/dccs/components/visual/dcc-button.js"></script>
  <script src="/dccs/components/visual/dcc-notice-input.js"></script>

  <script src="/dccs/components/web/dcc-rest.js"></script>
  <script src="/dccs/components/web/dcc-include.js"></script>
  <script src="/dccs/components/web/dcc-dhtml.js"></script>

  <script src="/dccs/components/data/dcc-table-csv.js"></script>
  <script src="/dccs/components/data/dcc-submit.js"></script>
  <script src="/dccs/components/data/dcc-model.js"></script>
  <script src="/dccs/components/data/dcc-record.js"></script>

  <script src="/dccs/base/subscribe-dcc.js"></script>
  <script src="/dccs/base/trigger-dcc.js"></script>
  <script src="/dccs/base/property-dcc.js"></script>
  <script src="/dccs/base/connect-dcc.js"></script>

  <script src="/infra/dcc-rest-proxy.js"></script>
  <script src="/infra/proxy/dcc-proxy-case.js"></script>
  <script src="/infra/dcc-basic.js"></script>
  <script src="/infra/dcc-logger.js"></script>
  <script src="/infra/dcc-logger-manager.js"></script>

  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="shortcut icon" href="/icons/favicon.ico">
  <link rel="manifest" href="/site.webmanifest">

  <link rel="stylesheet" href="/lib/fontawesome-5-10-1/css/all.min.css">
  <link rel="stylesheet" href="/lib/bootstrap-4.4.1/css/bootstrap.min.css">

  <link rel="stylesheet" href="/dccs/css/dccs.css">
  <link rel="stylesheet" href="/dccs/css/properties.css">
  <link rel="stylesheet" href="/infra/css/common-player.css">
  <link rel="stylesheet" href="/infra/css/common-author.css">

  <script src="/author/js/dcc-author-server-proxy.js"></script>

  <script src="/author/js/create.js"></script>
  <script src="/author/js/template-case.js"></script>
  <script src="/author/js/draft.js"></script>

  <script src="/context/context.js"></script>

  <script src="/dccs/components/control/dcc-timer.js"></script>
  <script src="/dccs/components/control/dcc-compute.js"></script>
  <script src="/dccs/components/control/dcc-message.js"></script>

  <script src="/dccs/components/visual/dcc-markdown.js"></script>
  <script src="/dccs/components/visual/dcc-annotation.js"></script>
  <script src="/dccs/components/visual/dcc-expression.js"></script>
  <script src="/dccs/components/visual/dcc-character.js"></script>
  <script src="/dccs/components/visual/dcc-lively-dialog.js"></script>
  <script src="/dccs/components/visual/dcc-state-select.js"></script>
  <script src="/dccs/components/visual/dcc-image-marker.js"></script>
  <script src="/dccs/base/dcc-styler.js"></script>
  <script src="/dccs/components/visual/dcc-entity.js"></script>
  <script src="/dccs/components/visual/dcc-input.js"></script>
  <script src="/dccs/components/visual/dcc-input-typed.js"></script>
  <script src="/dccs/components/visual/dcc-input-choice.js"></script>
  <script src="/dccs/components/visual/dcc-input-table.js"></script>
  <script src="/dccs/components/visual/dcc-input-summary.js"></script>
  <script src="/dccs/components/visual/dcc-chart.js"></script>
  <script src="/dccs/components/visual/dcc-slider.js"></script>
  <script src="/dccs/components/visual/dcc-report.js"></script>

  <!-- bundle cellular -->
  <script src="/dccs/components/cell/dcc-space-cellular.js"></script>
  <script src="/dccs/components/cell/dcc-cell.js"></script>
  <script src="/dccs/components/cell/dcc-cell-color.js"></script>
  <script src="/dccs/components/cell/dcc-cell-image.js"></script>
  <script src="/dccs/components/cell/dcc-cell-ruler.js"></script>
  <script src="/dccs/components/cell/rule-dcc-cell.js"></script>
  <script src="/dccs/components/cell/rule-dcc-cell-transition.js"></script>
  <script src="/dccs/components/cell/rule-dcc-cell-neighbor.js"></script>
  <script src="/dccs/components/cell/rule-dcc-cell-expression.js"></script>

  <script src="/lib/showdown/showdown.min.js"></script>

  <script src="/translator/translator.js"></script>
  <script src="/translator/item-templates.js"></script>

  <script src="/player/js/dcc-player-server-proxy.js"></script>
  <script src="/player/js/htracker.js"></script>
  <script src="/player/js/state.js"></script>
  <script src="/player/js/metaplayer.js"></script>
  <script src="/player/js/player.js"></script>
  <script src="/player/js/caselist.js"></script>

  <script>
    function start () {
      MessageBus.i.subscribe('download/track', download)
    }

    function download () {
      let d = new Date();

      let day = d.getDay().toString();
      let month = d.getMonth().toString();
      let h = d.getHours().toString();
      let m = d.getMinutes().toString();
      let s = d.getSeconds().toString();

      let chave = Math.floor(Math.random() * (9000 - 1 + 1)) + 1;
      let strkey = day + month + h + m + s + chave.toString();

      const ui = sessionStorage.getItem('harena-user-id')
      const trk = localStorage.getItem('harena-track')
      const st = localStorage.getItem('harena-state')

      const a = document.createElement('a')
      a.style.display = 'none'
      document.body.appendChild(a)
      a.href = window.URL.createObjectURL(
        new Blob([ui, '\n\n[[TRACK]]\n\n', trk,'\n\n[[STATE]]\n\n',st], {type: 'text/plain'}))
      a.setAttribute('download', `case${strkey}.track`)
      a.click()
      window.URL.revokeObjectURL(a.href)
      document.body.removeChild(a)
    }
  </script>
</head>
<body onload="start()">
    <dcc-button label="Download Track" topic="download/track"></dcc-button>
</body>
</html>
